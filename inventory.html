<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Inventory</title>
  <style>
    :root {
      color-scheme: dark;
      --bg: #060608;
      --panel: #0f1116;
      --border: #1c1f27;
      --accent: #71c9f8;
      --accent-strong: #9ae7ff;
      --text: #f1f5ff;
      --muted: #a4b3cc;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      background: radial-gradient(circle at 10% 15%, rgba(113, 201, 248, 0.08), transparent 25%),
        radial-gradient(circle at 80% -10%, rgba(154, 231, 255, 0.08), transparent 22%),
        var(--bg);
      color: var(--text);
      font-family: "Inter", "SF Pro Text", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      line-height: 1.6;
      padding: 28px 16px 42px;
    }

    a {
      color: var(--accent);
    }

    a:hover,
    a:focus-visible {
      color: var(--accent-strong);
    }

    .page {
      max-width: 1100px;
      margin: 0 auto;
      display: grid;
      gap: 16px;
    }

    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
      background: rgba(255, 255, 255, 0.02);
      border: 1px solid var(--border);
      padding: 12px 16px;
      border-radius: 12px;
    }

    .brand {
      font-weight: 700;
      letter-spacing: 0.3px;
    }

    .button {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 9px 12px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: rgba(255, 255, 255, 0.02);
      color: var(--text);
      text-decoration: none;
      font-weight: 600;
      transition: transform 120ms ease, border-color 120ms ease, background 120ms ease;
    }

    .button:hover,
    .button:focus-visible {
      transform: translateY(-1px);
      border-color: #2a2f3b;
      background: rgba(113, 201, 248, 0.08);
    }

    h1 {
      margin: 0;
      letter-spacing: 0.3px;
    }

    p.lead {
      margin: 0;
      color: var(--muted);
    }

    .panel {
      border: 1px solid var(--border);
      background: var(--panel);
      padding: 14px;
      border-radius: 12px;
      box-shadow: 0 14px 36px rgba(0, 0, 0, 0.32);
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 12px;
    }

    .controls label {
      display: grid;
      gap: 4px;
      font-size: 0.95rem;
      color: var(--muted);
    }

    input,
    select {
      background: #111420;
      color: #fff;
      border: 1px solid var(--border);
      padding: 9px;
      border-radius: 10px;
      font-family: inherit;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: #0a0d15;
      border-radius: 12px;
      overflow: hidden;
    }

    th,
    td {
      border: 1px solid var(--border);
      padding: 10px 8px;
      text-align: left;
    }

    th button {
      background: transparent;
      color: inherit;
      border: none;
      cursor: pointer;
      padding: 0;
      font: inherit;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    th button:hover,
    th button:focus-visible {
      color: var(--accent-strong);
    }

    .status {
      margin-top: 8px;
      color: var(--accent);
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="topbar">
      <div class="brand">Inventory</div>
      <div class="nav">
        <a class="button" href="index.html">Home</a>
        <a class="button" href="decks.html">Deck Browser</a>
      </div>
    </div>

    <div class="panel">
      <h1>Search your spare cards in seconds.</h1>
      <p class="lead">Type to search by name, box, or type. Sort any column, and filter by storage box or card type.</p>
    </div>

    <div class="panel">
      <div class="controls">
        <label>
          Search
          <input id="search" type="text" placeholder="Name, box, or type" />
        </label>
        <label>
          Box
          <select id="boxFilter"></select>
        </label>
        <label>
          Type
          <select id="typeFilter"></select>
        </label>
      </div>

      <table>
        <thead>
          <tr>
            <th><button data-sort="name">Name</button></th>
            <th><button data-sort="count">Count</button></th>
            <th><button data-sort="box">Box</button></th>
            <th><button data-sort="cmc">CMC</button></th>
            <th><button data-sort="type">Type</button></th>
            <th><button data-sort="unitValue">Unit Value</button></th>
            <th><button data-sort="totalValue">Total Value</button></th>
          </tr>
        </thead>
        <tbody id="tableBody"></tbody>
      </table>

      <div class="status" id="status">Loading inventory...</div>
    </div>
  </div>

  <script>
    const searchInput = document.getElementById("search");
    const boxFilter = document.getElementById("boxFilter");
    const typeFilter = document.getElementById("typeFilter");
    const tableBody = document.getElementById("tableBody");
    const status = document.getElementById("status");

    let inventory = [];
    let sortField = "name";
    let sortDirection = "asc";

    async function loadInventory() {
      try {
        const response = await fetch("inventory.md");
        if (!response.ok) {
          throw new Error("Unable to load inventory.md");
        }
        const text = await response.text();
        inventory = parseInventory(text);
        populateFilters();
        render();
        status.textContent = `Loaded ${inventory.length} entries.`;
      } catch (error) {
        console.error(error);
        status.textContent = error.message;
      }
    }

    function parseInventory(markdown) {
      const lines = markdown.split(/\r?\n/);
      const headerDividerIndex = lines.findIndex((line) => line.trim().startsWith("| ---"));
      if (headerDividerIndex === -1) return [];
      const dataLines = lines.slice(headerDividerIndex + 1).filter((line) => line.trim().startsWith("|"));
      return dataLines
        .map((line) => line.split("|").slice(1, -1).map((cell) => cell.trim()))
        .filter((cells) => cells.length >= 7 && cells[0])
        .map((cells) => ({
          name: cells[0],
          count: parseNumber(cells[1]),
          box: cells[2],
          cmc: parseNumber(cells[3]),
          type: cells[4],
          unitValue: cells[5],
          totalValue: cells[6],
        }));
    }

    function parseNumber(value) {
      const num = Number(value);
      return Number.isFinite(num) ? num : value;
    }

    function populateFilters() {
      const boxes = Array.from(new Set(inventory.map((item) => item.box))).filter(Boolean).sort();
      const types = Array.from(new Set(inventory.map((item) => item.type))).filter(Boolean).sort();
      fillSelect(boxFilter, boxes, "All boxes");
      fillSelect(typeFilter, types, "All types");
    }

    function fillSelect(select, options, placeholder) {
      select.innerHTML = "";
      const allOption = document.createElement("option");
      allOption.value = "";
      allOption.textContent = placeholder;
      select.appendChild(allOption);
      options.forEach((value) => {
        const option = document.createElement("option");
        option.value = value;
        option.textContent = value;
        select.appendChild(option);
      });
    }

    function render() {
      const searchTerm = searchInput.value.trim().toLowerCase();
      const box = boxFilter.value;
      const type = typeFilter.value;

      const filtered = inventory.filter((item) => {
        const matchesSearch = searchTerm
          ? [item.name, item.box, item.type].some((field) => (field || "").toLowerCase().includes(searchTerm))
          : true;
        const matchesBox = box ? item.box === box : true;
        const matchesType = type ? item.type === type : true;
        return matchesSearch && matchesBox && matchesType;
      });

      filtered.sort((a, b) => {
        const direction = sortDirection === "asc" ? 1 : -1;
        const aValue = a[sortField];
        const bValue = b[sortField];
        if (typeof aValue === "number" && typeof bValue === "number") {
          return (aValue - bValue) * direction;
        }
        return String(aValue).localeCompare(String(bValue)) * direction;
      });

      tableBody.innerHTML = filtered
        .map(
          (item) => `
          <tr>
            <td>${item.name}</td>
            <td>${item.count}</td>
            <td>${item.box}</td>
            <td>${item.cmc}</td>
            <td>${item.type}</td>
            <td>${item.unitValue}</td>
            <td>${item.totalValue}</td>
          </tr>
        `
        )
        .join("");

      status.textContent = filtered.length ? `${filtered.length} item(s) shown.` : "No matching cards.";
    }

    function setSort(field) {
      if (sortField === field) {
        sortDirection = sortDirection === "asc" ? "desc" : "asc";
      } else {
        sortField = field;
        sortDirection = "asc";
      }
      render();
    }

    document.querySelectorAll("th button").forEach((button) => {
      button.addEventListener("click", () => setSort(button.dataset.sort));
    });

    searchInput.addEventListener("input", render);
    boxFilter.addEventListener("change", render);
    typeFilter.addEventListener("change", render);

    loadInventory();
  </script>
</body>
</html>
